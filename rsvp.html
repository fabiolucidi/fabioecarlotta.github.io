---
layout: default
title: RSVP
---

<div class="form-container">
    <h2>RSVP</h2>

    <form id="rsvp-form">

        <!-- STEP 1 -->
        <div class="step active" id="step-1">
            <h3 class="step-title">General Information</h3>

            <div class="floating-label">
                <input type="text" id="nome" name="nome" required placeholder=" " />
                <label>Name*</label>
            </div>

            <div class="floating-label">
                <input type="text" id="cognome" name="cognome" required placeholder=" " />
                <label>Surname*</label>
            </div>

            <div class="phone-row">
                <div class="floating-label">
                    <input type="text" id="prefix" name="prefix" required placeholder=" " pattern="[0-9+() ]+" />
                    <label>Prefix*</label>
                </div>

                <div class="floating-label">
                    <input type="text" id="telefono" name="telefono" required placeholder=" " pattern="[0-9+() ]+" />
                    <label>Phone number*</label>
                </div>
            </div>

            <div class="floating-label">
                <input type="email" id="email" name="email" placeholder=" " />
                <label>Email</label>
            </div>

            <button type="button" class="next-btn">Next</button>
        </div>

        <!-- STEP 2 -->
        <div class="step" id="step-2">
            <h3 class="step-title">Travel information</h3>

            <div class="floating-label">
                <select id="arrivo" name="arrivo" required>
                    <option value="" disabled selected hidden></option>
                    <option value="19/06">19/06</option>
                    <option value="20/06">20/06</option>
                    <option value="I live in Verona">I live in Verona</option>
                </select>
                <label>When will you arrive?</label>
            </div>

            <div class="floating-label">
                <select id="shuttle" name="shuttle" required>
                    <option value="" disabled selected hidden></option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                </select>
                <label>Will you use the shuttle?</label>
            </div>

            <button type="button" class="back-btn">Back</button>
            <button type="button" class="next-btn">Next</button>
        </div>

        <!-- STEP 3 -->
        <div class="step" id="step-3">
            <h3 class="step-title">Food information</h3>

            <div class="floating-label">
                <select id="allergie" name="allergie" required>
                    <option value="" disabled selected hidden></option>
                    <option value="No">No</option>
                    <option value="Yes">Yes</option>
                </select>
                <label>Do you have any allergies?</label>
            </div>

            <div class="floating-label" id="allergieField" style="display:none;">
                <textarea id="listaAllergie" name="listaAllergie" placeholder=" "></textarea>
                <label>If yes, specify</label>
            </div>

            <div class="floating-label">
                <select id="dieta" name="dieta" required>
                    <option value="" disabled selected hidden></option>
                    <option value="No">No</option>
                    <option value="Yes">Yes</option>
                </select>
                <label>Diet restrictions?</label>
            </div>

            <div class="floating-label" id="dietaField" style="display:none;">
                <select id="tipoDieta" name="tipoDieta">
                    <option value="" disabled selected hidden></option>
                    <option value="Vegetarian">Vegetarian</option>
                    <option value="Vegan">Vegan</option>
                </select>
                <label>If yes, choose</label>
            </div>

            <button type="button" class="back-btn">Back</button>
            <button type="button" class="next-btn">Next</button>
        </div>

        <!-- STEP 4 -->
        <div class="step" id="step-4">
            <h3 class="step-title">Others</h3>

            <div class="floating-label">
                <textarea id="messaggio" name="messaggio" maxlength="500" placeholder=" "></textarea>
                <label>Anything else? ðŸ˜Š</label>
            </div>

            <p id="char-count">0/500</p>

            <button type="button" class="back-btn">Back</button>
            <button type="submit" class="submit-btn">Send RSVP</button>
        </div>

    </form>

    <div id="thankyou-animation"></div>
</div>

<!-- reCAPTCHA -->
<script src="https://www.google.com/recaptcha/api.js?render=6LfSNhosAAAAAAGFpMX5do3nDtl8ImAYIgpHLV8k
"></script>

<!-- Confetti -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
    /* ======================
       CONFIG
    ====================== */
    const ENDPOINT = "https://script.google.com/macros/s/AKfycbzcQGQ60WkODHxLqcFzYCBgAkc_aUh_KFu51JJVJbH-zQL-un5v18X3FuaQVipb6Uuj/exec";
    const SITE_KEY = "6LfSNhosAAAAAAGFpMX5do3nDtl8ImAYIgpHLV8k";

    /* ======================
       MULTISTEP LOGIC
    ====================== */
    let currentStep = 1;
    const steps = document.querySelectorAll(".step");

    function showStep(n) {
        steps.forEach(s => s.classList.remove("active"));
        document.getElementById("step-" + n).classList.add("active");
        currentStep = n;
    }

    document.addEventListener("DOMContentLoaded", () => showStep(1));

    document.querySelectorAll(".next-btn").forEach(btn =>
        btn.addEventListener("click", () => showStep(currentStep + 1))
    );

    document.querySelectorAll(".back-btn").forEach(btn =>
        btn.addEventListener("click", () => showStep(currentStep - 1))
    );

    /* Toggle campi allergie/dieta */
    document.getElementById("allergie").addEventListener("change", e =>
        document.getElementById("allergieField").style.display =
            e.target.value === "Yes" ? "block" : "none"
    );
    document.getElementById("dieta").addEventListener("change", e =>
        document.getElementById("dietaField").style.display =
            e.target.value === "Yes" ? "block" : "none"
    );

    /* Contatore caratteri */
    document.getElementById("messaggio").addEventListener("input", function () {
        document.getElementById("char-count").textContent = this.value.length + "/500";
    });

    /* ======================
       SUBMIT + RECAPTCHA
    ====================== */
    document.getElementById("rsvp-form").addEventListener("submit", function (e) {
        e.preventDefault();

        grecaptcha.ready(() => {
            grecaptcha.execute(SITE_KEY, { action: "submit" }).then(async token => {
                const params = new URLSearchParams();

                const fields = [
                    "nome","cognome","prefix","telefono","email",
                    "arrivo","shuttle","allergie","listaAllergie",
                    "dieta","tipoDieta","messaggio"
                ];

                fields.forEach(f => params.append(f, document.getElementById(f)?.value || ""));
                params.append("token", token);

                try {
                    const res = await fetch(ENDPOINT, {
                        method: "POST",
                        headers: { "Content-Type": "application/x-www-form-urlencoded" },
                        body: params.toString()
                    });

                    const json = await res.json();

                    if (json.status === "success") {
                        launchConfetti();
                        showStep(1);
                        document.getElementById("rsvp-form").reset();
                        alert("Grazie! Il tuo RSVP Ã¨ stato inviato.");
                    } else {
                        alert("Errore: " + JSON.stringify(json));
                    }

                } catch (err) {
                    console.error(err);
                    alert("Errore di connessione.");
                }
            });
        });
    });

    /* ======================
       CONFETTI
    ====================== */
    function launchConfetti() {
        var duration = 1500;
        var end = Date.now() + duration;

        (function frame() {
            confetti({ particleCount: 5, spread: 60 });
            if (Date.now() < end) requestAnimationFrame(frame);
        })();
    }
</script>
